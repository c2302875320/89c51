C51 COMPILER V9.60.7.0   TIMER                                                             04/10/2024 02:05:32 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE TIMER
OBJECT MODULE PLACED IN .\Objects\TIMER.obj
COMPILER INVOKED BY: D:\keil_c51\C51\BIN\C51.EXE Lib\src\TIMER.c WARNINGLEVEL(0) OPTIMIZE(9,SPEED) BROWSE INCDIR(.\Lib\i
                    -nc;.\Lib;.\User) DEBUG OBJECTEXTEND PRINT(.\Listings\TIMER.lst) OBJECT(.\Objects\TIMER.obj)

line level    source

   1          #include "TIMER.h"
   2          
   3          /*T0/T1²ÅÓÐÒÔÉÏ¹¤×÷Ä£Ê½£¬³ÆÖ®Îª´«Í³¶¨Ê±Æ÷£¬Ö»ÄÜÏòÉÏ¼ÆÊý
   4          µ±Ñ¡Ôñ·½Ê½3Ê±£¬¶¨Ê±Æ÷T0¾Í»á±»·Ö³ÉÁ½¸ö¶ÀÁ¢µÄ¼ÆÊýÆ÷»òÕß¶¨Ê±Æ÷¡£
   5          ´ËÊ±£¬TL0Îª8Î»¼ÆÊýÆ÷£¬¼ÆÊýÒç³öºÃÖÃÎ»TF0£¬²¢ÏòCPUÉêÇëÖÐ¶Ï£¬Ö®ºóÐèÒªÈí¼þÖØ×°³õÖµ£»
   6          TH0Ò²±»¹Ì¶¨Îª8Î»¼ÆÊýÆ÷£¬²»¹ýTL0ÒÑ¾­Õ¼ÓÃÁËTF0ºÍTR0£¬Òò´ËTH0½«Õ¼T1µÄÖÐ¶ÏÇëÇó±êÖ¾TF1ºÍ¶¨Ê±Æ÷Æô¶¯¿ØÖÆÎªTR1¡£
   7          
   8          Ò»°ãÅäÖÃÁ÷³Ì£º
   9          µÚÒ»²½£ºÅäÖÃ¹¤×÷·½Ê½¼Ä´æÆ÷¡ªTMOD
  10          µÚ¶þ²½£º¸³³õÖµ ¡ª¡ª THx¡¢TLx
  11          µÚÈý²½£ºÅäÖÃ¿ØÖÆ¼Ä´æÆ÷¡ª¡ªTCON 
  12          µÚËÄ²½£º¿ª×ÜÖÐ¶Ï¡ª¡ªEA = 1£»
  13          */
  14          
  15          /*
  16          Ä£Ê½¿ØÖÆ¼Ä´æÆ÷TMOD£º GATE  C/T M1 M0 GATE C/T M1 M0
  17          ¿ØÖÆ¼Ä´æÆ÷TCON: TF1 TR1 TF0 TR0 IE1 TT1 IE0 IT0
  18          
  19          GATE -- ÊÇ·ñÓÉÍâ²¿ÖÐ¶ÏÒý½ÅÀ´¿ªÆô¶¨Ê±Æ÷ÖÐ¶Ï
  20          C/T -- Íâ²¿Ê±ÖÓ»¹ÊÇÄÚ²¿Ê±ÖÓ
  21          
  22          T2CON:     
  23          TF2         =           T2CON^7;
  24          
  25          EXF2        =           T2CON^6;
  26          µ±EXEN2=1ÇÒT2EX£¨µ¥Æ¬»úµÄP1.1¿Ú£©µÄ¸ºÌø±ä²úÉú²¶×½»òÖØ×°Ê±£¬EXF2ÖÃÎ»¡£¶¨Ê±Æ÷2ÖÐ¶ÏÊ¹ÄÜÊ±£¬
  27          EXF2=1½«Ê¹CPU½øÈë¶¨Ê±Æ÷2µÄÖÐ¶Ï·þÎñ³ÌÐò¡£EXF2±ØÐëÓÃÈí¼þÇå0¡£ÔÚµÝÔö/µÝ¼õ¼ÆÊýÆ÷Ä£Ê½£¨DCEN=1£©ÖÐ£¬EXF2²»»áÒýÆð
             -ÖÐ¶Ï¡£
  28          
  29          RCLK        =           T2CON^5;ÖÃ1Ê±½«¶¨Ê±Æ÷2Òç³öÂö³å×÷Îª´®¿Ú·½Ê½1»òÕß·½Ê½3µÄ½ÓÊÕÊ±ÖÓ£¬0ÔòÊ¹ÓÃ¶¨Ê±Æ÷1 
  30          TCLK        =           T2CON^4;ÖÃ1Ê±½«¶¨Ê±Æ÷2Òç³öÂö³å×÷Îª´®¿Ú·½Ê½1»òÕß·½Ê½3µÄ·¢ËÍÊ±ÖÓ£¬0ÔòÊ¹ÓÃ¶¨Ê±Æ÷1 
  31          EXEN2       =           T2CON^3;
  32          µ±EXEN2=1ÇÒ¶¨Ê±Æ÷2Î´ÓÃ×÷´®ÐÐ¿ÚÊ±ÖÓÊ±£¬ÔÊÐíT2EXÒý½ÅµÄ¸ºÌø±ä²úÉú²¶»ñ»òÖØ×°£»µ±EXEN2=0Ê±£¬T2EXÒý½ÅµÄ¸ºÌø±ä¶Ô¶
             -¨Ê±Æ÷2ÎÞÐ§¡£
  33          
  34          ÕâÀïÎÒÃÇÒª¶Ô²¶»ñ½øÐÐÒ»ÏÂ½âÊÍ£¬Í¨Ë×µØ½²£¬²¶»ñ¾ÍÊÇ²¶×½Ä³Ò»Ë²¼äµÄÖµ£¬Í¨³£ËüÓÃÀ´²âÁ¿Íâ²¿Ä³¸öÂö³åµÄ¿í¶È»òÖÜÆÚ£¬
  35          Ê¹ÓÃ²¶»ñ¹¦ÄÜ¿ÉÒÔ×¼È·µØ²âÁ¿³öÂö³åµÄ¿í¶È»òÖÜÆÚ¡£
  36          ²¶»ñµÄ¹¤×÷Ô­ÀíÊÇ£ºµ¥Æ¬»úÄÚ²¿ÓÐÁ½×é¼Ä´æÆ÷£¬ÆäÖÐÒ»×éµÄÄÚ²¿ÊýÖµÊÇ°´¹Ì¶¨»úÆ÷ÖÜÆÚµÝÔö»òµÝ¼õµÄ£¬
  37          Í¨³£Õâ×é¼Ä´æÆ÷¾ÍÊÇµ¥Æ¬»úÄÚ²¿¶¨Ê±Æ÷µÄ¼ÆÊýÆ÷¼Ä´æÆ÷£¨TLn£¬THn£©£¬µ±Óë²¶»ñ¹¦ÄÜÏà¹ØµÄÍâ²¿Ä³Òý½ÅÓÐÒ»¸ö¸ºÌø±äÊ±£¬
  38          ²¶»ñ±ã»áÁ¢¼´½«´ËÊ±µÚÒ»×é¼Ä´æÆ÷ÖÐµÄÊýÖµ×¼È·µØ²¶»ñ£¬²¢ÇÒ´æÈëÁíÒ»×é¼Ä´æÆ÷ÖÐ£¬
  39          Õâ×é¼Ä´æÆ÷Í¨³£±»³ÆÎª¡°ÏÝÚå¼Ä´æÆ÷¡±£¨RCAPnL£¬RCAPnH£©£¬Í¬Ê±ÏòCPUÉêÇëÖÐ¶Ï£¬
  40          Èí¼þ¼ÇÂ¼Á½´Î²¶»ñÖ®¼äµÄÊý¾Ýºó£¬±ã¿ÉÒÔ×¼È·µØ¼ÆËã³ö¸ÃÂö³åµÄÖÜÆÚ¡£
  41          
  42          
  43          TR2         =           T2CON^2; 1:Æô¶¯ 0£º¹Ø±Õ
  44          C_T2        =           T2CON^1; 1:¼ÆÊýÆ÷£¨ÏÂ½µÑØ´¥·¢£©Ñ¡Ôñ 0:¶¨Ê±Æ÷
  45          CP_RL2      =           T2CON^0; 1£º²¶×½ 0£ºÖØ×°
  46                  
  47              RCAP2H: ÖØ×°¸ß°ËÎ»    
  48              RCAP2L: ÖØ×°µÍ°ËÎ»
  49          
  50              T2H: ³õÊ¼¸ß°ËÎ»
  51              T2L: ³õÊ¼µÍ°ËÎ»
  52              
C51 COMPILER V9.60.7.0   TIMER                                                             04/10/2024 02:05:32 PAGE 2   

  53          T2MOD:  T2OE             DCEN
  54                 Êä³öÊ¹ÄÜÎ»      ÏòÉÏ/ÏòÏÂ¼ÆÊýÎ»
  55                 
  56          
  57          ¹¤×÷·½Ê½3Ö»ÊÊÓÃÓÚ¶¨Ê±Æ÷0¡£Èç¹ûÊ¹¶¨Ê±Æ÷0Îª¹¤×÷·½Ê½3£¬Ôò¶¨Ê±Æ÷1½«´¦ÓÚ¹Ø±Õ×´Ì¬¡£
  58          µ±T0Îª¹¤×÷·½Ê½3Ê±£¬TH0ºÍTL0·Ö³É2¸ö¶ÀÁ¢µÄ8Î»¼ÆÊýÆ÷¡£
  59          ÆäÖÐ£¬TL0¼È¿ÉÓÃ×÷¶¨Ê±Æ÷£¬ÓÖ¿ÉÓÃ×÷¼ÆÊýÆ÷£¬²¢Ê¹ÓÃÔ­T0µÄËùÓÐ¿ØÖÆÎ»TR0¼°Æä¶¨Ê±Æ÷»ØÁã±êÖ¾TF0ºÍÖÐ¶ÏÔ´¡£
  60          TH0Ö»ÄÜÓÃ×÷¶¨Ê±Æ÷£¬²¢Ê¹ÓÃT1µÄ¿ØÖÆÎ»TR1¡¢»ØÁã±êÖ¾TFlºÍÖÐ¶ÏÔ´¡£
  61          
  62          Í¨³£Çé¿öÏÂ£¬T0²»ÔËÐÐÓÚ¹¤×÷·½Ê½3£¬Ö»ÓÐÔÚT1´¦ÓÚ¹¤×÷·½Ê½2£¬²¢²»ÒªÇóÖÐ¶ÏµÄÌõ¼þÏÂ²Å¿ÉÄÜÊ¹ÓÃ¡£
  63          ÕâÊ±£¬T1ÍùÍùÓÃ×÷´®ÐÐ¿Ú²¨ÌØÂÊ·¢ÉúÆ÷£¬TH0ÓÃ×÷¶¨Ê±Æ÷£¬TL0×÷Îª¶¨Ê±Æ÷»ò¼ÆÊýÆ÷¡£
  64          ËùÒÔ£¬·½Ê½3ÊÇÎªÁËÊ¹µ¥Æ¬»úÓÐ1¸ö¶ÀÁ¢µÄ¶¨Ê±Æ÷£¯¼ÆÊýÆ÷¡¢1¸ö¶¨Ê±Æ÷ÒÔ¼°1¸ö´®ÐÐ¿Ú²¨ÌØÂÊ·¢ÉúÆ÷µÄÓ¦ÓÃ³¡ºÏ¶øÌØµØÌá¹©
             -µÄ¡£
  65          ÕâÊ±£¬¿É°Ñ¶¨Ê±Æ÷lÓÃÓÚ¹¤×÷·½Ê½2£¬°Ñ¶¨Ê±Æ÷0ÓÃÓÚ¹¤×÷·½Ê½3¡£
  66          
  67          
  68          »úÆ÷ÖÜÆÚ  = 1/12Mhz/12 = 1*10^(-6) = 1us    1us * 10000 = 0.1s=100ms
  69          */
  70          
  71          sbit EXAMPLE_LED0 = P1^0;
  72          sbit EXAMPLE_LED1 = P1^1;
  73          sbit EXAMPLE_LED2= P1^2;
  74          
  75          
  76          void TIMER_Init(u8 SET_TMOD,u8 USE_TIMER,u16 TIMER_PULSE)
  77          {
  78   1          u8 THx,TLx,CT,GATE,MODE;
  79   1          
  80   1          if(USE_TIMER == USE_TIMER0)
  81   1          {
  82   2              MODE = SET_TMOD&3;
  83   2              CT = SET_TMOD&4;
  84   2              GATE = SET_TMOD&8;
  85   2          }
  86   1          
  87   1          if(USE_TIMER == USE_TIMER1)
  88   1          {
  89   2              MODE = (SET_TMOD&48)>>4;
  90   2              CT = (SET_TMOD&64)>>4;
  91   2              GATE = (SET_TMOD&128)>>4;
  92   2          }
  93   1          
  94   1          
  95   1          if(MODE = 0)//13Î»Òç³ö
  96   1          {
  97   2              if(TIMER_PULSE<8191 && TIMER_PULSE>0) ;//Í£Ö¹¶¨Ê±Æ÷Ê¹ÄÜ
  98   2              {
  99   3                  THx = (8191 - TIMER_PULSE)/256;
 100   3                  THx &= 31; //Ö»È¡µÍ5Î»
 101   3                  TLx = (8191 - TIMER_PULSE)%256;
 102   3              }
 103   2          }            
 104   1          
 105   1          if(MODE = 1)//16Î»Òç³ö
 106   1          {
 107   2              if(TIMER_PULSE<65535 && TIMER_PULSE>0)
 108   2              {
 109   3                  THx = (65535 - TIMER_PULSE)/256;
 110   3                  TLx = (65535 - TIMER_PULSE)%256;
 111   3              }
 112   2          }  
 113   1          
C51 COMPILER V9.60.7.0   TIMER                                                             04/10/2024 02:05:32 PAGE 3   

 114   1          if(MODE = 2)//8Î»ÖØ×°£¬TH×÷ÎªÖØ×°Öµ £¬TL×÷Îª³õÊ¼Öµ
 115   1          {
 116   2              if(TIMER_PULSE<255 && TIMER_PULSE>0)
 117   2              {
 118   3                  THx = TLx = 255 - TIMER_PULSE;
 119   3              }
 120   2          }  
 121   1          
 122   1          if (USE_TIMER == USE_TIMER0)
 123   1          {
 124   2              TH0 = THx;
 125   2              TL0 = TLx;
 126   2          }
 127   1          
 128   1          if (USE_TIMER == USE_TIMER1)
 129   1          {
 130   2              TH1 = THx;
 131   2              TL1 = TLx;
 132   2          }
 133   1          
 134   1      
 135   1          
 136   1          TMOD = SET_TMOD;
 137   1          if (USE_TIMER == USE_TIMER1)
 138   1          {
 139   2              TR1 = 1;
 140   2              ET1 = 1;
 141   2          }
 142   1          if (USE_TIMER == USE_TIMER0)
 143   1          {
 144   2              TR0 = 1;
 145   2              ET0 = 1;  
 146   2          }
 147   1          EA = 1;
 148   1      }
 149          
 150          void TIMER2_Init(u16 TIMER_PULSE)
 151          {
 152   1          TH2 = (65535-TIMER_PULSE)/256;
 153   1          TL2 = (65535-TIMER_PULSE)%256;
 154   1          RCAP2H =  TH2;
 155   1          RCAP2L = TL2;
 156   1          TR2 = 1;
 157   1          ET2 = 1;
 158   1          EA = 1;
 159   1      }
 160          
 161          void TIMER0() interrupt 1{
 162   1          
 163   1          if(TF0)TF0=0;
 164   1          TH0 = (65535-1000)/256;
 165   1          TL0 = (65535-1000)%256;
 166   1          EXAMPLE_LED0 = ~EXAMPLE_LED0;
 167   1      
 168   1      }
 169          
 170          void TIMER1() interrupt 3{
 171   1          
 172   1          if(TF1)TF1=0;
 173   1          TH1 = (65535-5000)/256;
 174   1          TL1 = (65535-5000)%256;
 175   1          EXAMPLE_LED1 = ~EXAMPLE_LED1;
C51 COMPILER V9.60.7.0   TIMER                                                             04/10/2024 02:05:32 PAGE 4   

 176   1      
 177   1      }
 178          
 179          void TIMER2() interrupt 5{
 180   1          
 181   1          if(TF2)TF2=0;
 182   1          
 183   1          EXAMPLE_LED2 = ~EXAMPLE_LED2;
 184   1      
 185   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    317    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      11
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
