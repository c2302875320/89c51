C51 COMPILER V9.60.7.0   IIC                                                               04/10/2024 01:39:04 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE IIC
OBJECT MODULE PLACED IN .\Objects\IIC.obj
COMPILER INVOKED BY: D:\keil_c51\C51\BIN\C51.EXE Lib\src\IIC.c WARNINGLEVEL(0) OPTIMIZE(9,SPEED) BROWSE INCDIR(.\Lib\inc
                    -;.\Lib;.\User) DEBUG OBJECTEXTEND PRINT(.\Listings\IIC.lst) OBJECT(.\Objects\IIC.obj)

line level    source

   1          /*
   2          Ӳ
   3          ֶ֧ӣ400pF
   4          ٲ÷ʽ
   5          ģʽ100kbit/s 400kbit/s 3-4kbit/s
   6          
   7          
   8          Э
   9          
  10          1.ЧԹ涨SCLߵƽʱSDAȶ
  11          2.ʼźţSCLΪߣSDAɸߵƽɵ͵ƽ 
  12          3.ֹźţSCLΪߣSDAɵ͵ƽɸߵƽ
  13          4.Ӧźţӻ ACKźţNACKź
  14          
  15          
  16          Ѱַ
  17          7λѰַ  һλR/W
  18          10λѰַ
  19          
  20          ӻдݣ
  21          
  22          1.ȲSTARTź
  23          2.Ȼŷһӻַַ7λŵĵ8λݷ λ(R/W)0ʾ(д)1
             -ʾ()
  24          3.͵ַʱϵÿӻ7λַԼĵַбȽϣͬΪԼڱѰַ
             -R/TλԼȷΪͽ
  25          4.ʱȴӻӦź(A)
  26          5.յӦźʱҪʴӻǸַ ȴӻӦź
  27          6.յӦźʱNֽڵݣȴӻNӦźţ
  28          7.ֹͣźţ͹̡
  29          
  30          
  31          ҪӴӻʱ
  32          1.ȲSTARTź
  33          2.Ȼŷһӻַעʱõַĵ8λΪ0ӻд
  34          3.ʱȴӻӦź(ACK)
  35          4.յӦźʱҪʵĵַȴӻӦźţ
  36          5.յӦźźҪıͨģʽ(ɷͱΪգӻɽձΪ)·һ
             -ʼstartźţȻŷһӻַעʱõַĵ8λΪ1 óɽģʽʼȡݣ
  37          6.ʱȴӻӦźţյӦźʱͿԽ1ֽڵݣɺͷӦ
             -źţʾڽ
  38          7.ֹͣźţ͹̡
  39          
  40          
  41          
  42          
  43          */
  44          
  45          //I2C
  46          #include "IIC.h"
  47          
  48          /**
  49             *@breaf       I2Cʼź
  50             *@param      
C51 COMPILER V9.60.7.0   IIC                                                               04/10/2024 01:39:04 PAGE 2   

  51             *@retval     
  52             
  53             SCL:  ____|_
  54                       | \
  55                       |  \____
  56             SDA:  ____|
  57                       |\
  58                       | \_____
  59                        
  60          */
  61          void IIC_Start(void)
  62          {
  63   1          C51_IIC_SDA = 1;
  64   1          C51_IIC_SCL = 1;
  65   1          
  66   1          _nop_();_nop_();
  67   1          C51_IIC_SDA = 0;
  68   1          
  69   1          _nop_();_nop_();
  70   1          C51_IIC_SCL = 0;
  71   1      }
  72          
  73           /**
  74             *@breaf       I2Cź
  75             *@param      
  76             *@retval     
  77             
  78             SCL:     _____
  79                     / 
  80               ____ /
  81             SDA:       ____
  82                       /
  83                  ____/ 
  84                        
  85          */
  86          void IIC_Stop(void)
  87          {
  88   1          C51_IIC_SDA = 0;
  89   1          C51_IIC_SCL = 1;
  90   1          
  91   1          _nop_();_nop_();
  92   1          C51_IIC_SDA = 1;
  93   1          _nop_();_nop_();
  94   1          C51_IIC_SCL = 0;
  95   1      }
  96          
  97          
  98          void IIC_IDLE(void)
  99          {
 100   1          C51_IIC_SDA = 1;
 101   1          C51_IIC_SCL = 1; 
 102   1      }
 103          
 104          
 105          
 106          /**
 107             *@breaf  I2Cֽں
 108             *@param ByteҪ͵ֽ
 109             *@retval 
 110          SCL͵ƽڼ䣬ληSDAϣλǰ
 111          ȻSCLӻSCLλڼȡλSCLλڼ䲻SDAݷ仯
 112          νѭ8ΣʵһֽݵĴ䡣 
C51 COMPILER V9.60.7.0   IIC                                                               04/10/2024 01:39:04 PAGE 3   

 113             */
 114          void IIC_SendByte(u8 Byte)
 115          {
 116   1          u8 i;
 117   1          
 118   1          C51_IIC_SCL=0;
 119   1          for(i=0;i<8;i++)
 120   1          {
 121   2              C51_IIC_SDA = Byte&0x80;
 122   2              C51_IIC_SCL=1;
 123   2              _nop_();_nop_();
 124   2              C51_IIC_SCL=0;
 125   2              _nop_();_nop_();
 126   2              
 127   2              Byte=Byte<<1;
 128   2          }
 129   1      }
 130          
 131          
 132          /**
 133          *@breaf  I2Cֽں
 134          *@param 
 135          *@retval Byte
 136          SCL͵ƽڼ䣬ӻληSDAϣλǰ
 137          ȻSCLSCLߵƽڼȡݣSCLߵƽڼ䣬SDAݷ仯
 138          ѭ8ΣɽܽһֽڣǰǰҪͷ(SDA
 139          */
 140          
 141          
 142          u8 IIC_ReceiveByte()
 143          {
 144   1          u8 Byte=0,i;
 145   1          
 146   1          C51_IIC_SDA = 1;//ͷSDA
 147   1          C51_IIC_SCL = 0;
 148   1          for(i=0;i<8;i++)
 149   1          {
 150   2      
 151   2              C51_IIC_SCL=1;//
 152   2              _nop_();_nop_();
 153   2              
 154   2              Byte=Byte<<1|C51_IIC_SDA;
 155   2              
 156   2              C51_IIC_SCL=0;
 157   2              _nop_();_nop_();
 158   2           }
 159   1          
 160   1           return Byte;
 161   1      }
 162          
 163          
 164          
 165          /**
 166          *@breaf I2CӦ
 167          *@param AckBit Ӧλ0ΪӦ1ΪӦ
 168          *@retval 
 169          */
 170          void IIC_SendAck(u8 AckBit)
 171          {
 172   1              C51_IIC_SDA=AckBit;
 173   1              
 174   1              C51_IIC_SCL=1;
C51 COMPILER V9.60.7.0   IIC                                                               04/10/2024 01:39:04 PAGE 4   

 175   1              _nop_();_nop_();
 176   1              C51_IIC_SCL=0;
 177   1              _nop_();_nop_();
 178   1      }
 179          
 180          
 181          /**
 182          *@breaf I2CӦ
 183          *@param
 184          *@retval AckBit  Ӧλ0ΪӦ1ΪӦ
 185          */
 186          u8 IIC_ReceiveAck()
 187          {
 188   1              u8 AckBit;
 189   1          
 190   1              C51_IIC_SDA=1;
 191   1              C51_IIC_SCL=0;
 192   1          
 193   1              C51_IIC_SCL=1;
 194   1              _nop_();_nop_();
 195   1              AckBit=C51_IIC_SDA;
 196   1              C51_IIC_SCL=0;
 197   1              _nop_();_nop_();
 198   1          
 199   1              return AckBit;
 200   1      }
 201          
 202          
 203          
 204           
 205          
 206          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    118    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
